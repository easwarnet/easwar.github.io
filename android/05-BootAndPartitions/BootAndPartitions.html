<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BootAndPartitions &mdash; Easwarnet  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="NativeAppDevelopment" href="../06-NativeAppDevelopment/NativeAppDevelopment.html" />
    <link rel="prev" title="Flashing Android" href="../04-SoftwareUpdate/SoftwareUpdate.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Easwarnet
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">C++</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cpp-smartptr.html">C++ - Smart Pointer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpp-inheritence.html">C++ - Inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpp-container.html">C++ - Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpp-stdlib.html">C++ - StdLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpp-general.html">C++ - General</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../linux-posix.html">Linux - Posix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux-commands.html">Linux - Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../os-general.html">Os - General Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AOSP Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01-Introduction/Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-AndroidBuildSystem/AndroidBuildSystem.html">AndroidBuildSystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-AndroidTools/AndroidTools.html">AndroidTools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04-SoftwareUpdate/SoftwareUpdate.html">Flashing Android</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">BootAndPartitions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#boot-sequence"><strong>Boot Sequence</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#boot-sequence-diagram">Boot Sequence Diagram</a></li>
<li class="toctree-l2"><a class="reference internal" href="#primary-bootloader">Primary Bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#secondary-bootloader">Secondary Bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kernel">Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initramfs">Initramfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rootfs">RootFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#init-process">Init Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#zygote">Zygote</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-services">System Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="#partitions-in-android"><strong>Partitions in Android</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#bootloaders">Bootloaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tz-trustzone">TZ (TrustZone)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vbmeta">VBMETA</a></li>
<li class="toctree-l2"><a class="reference internal" href="#boot-partition">Boot Partition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dtbo">DTBO</a></li>
<li class="toctree-l2"><a class="reference internal" href="#recovery">Recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vendor">Vendor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="#userdata">Userdata</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cache">Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="#odm">ODM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vndk">VNDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#project-treble">Project Treble</a></li>
<li class="toctree-l2"><a class="reference internal" href="#secure-boot"><strong>Secure Boot</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1"><strong>Project Treble</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#before-treble">Before Treble</a></li>
<li class="toctree-l2"><a class="reference internal" href="#after-treble">After Treble</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../06-NativeAppDevelopment/NativeAppDevelopment.html">NativeAppDevelopment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07-AndroidIPC/AndroidIPC.html">AndroidIPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08-AppCoreComponents/AppCoreComponents.html">AppCoreComponents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09-TestFramework/TestFramework.html">TestFramework</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Embedded Beginner</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../os-rtos.html">Os - RTOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c-pointers.html">C - Pointers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c-funcpointers.html">C - Function Pointers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c-general.html">C - General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c-basicalgo.html">C - Basic Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c-tricks.html">C - Tricks and Others</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../profile.html"><strong>About</strong></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Easwarnet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>BootAndPartitions</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="bootandpartitions">
<h1>BootAndPartitions<a class="headerlink" href="#bootandpartitions" title="Permalink to this heading"></a></h1>
<section id="boot-sequence">
<h2><strong>Boot Sequence</strong><a class="headerlink" href="#boot-sequence" title="Permalink to this heading"></a></h2>
<p>This topic explains how Android Boots from when its powered on till Android UI starts to run.</p>
</section>
<section id="boot-sequence-diagram">
<h2>Boot Sequence Diagram<a class="headerlink" href="#boot-sequence-diagram" title="Permalink to this heading"></a></h2>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/bootsequence.png"><img alt="../../_images/bootsequence.png" src="../../_images/bootsequence.png" style="width: 342.0px; height: 590.0px;" /></a>
</figure>
</section>
<section id="primary-bootloader">
<h2>Primary Bootloader<a class="headerlink" href="#primary-bootloader" title="Permalink to this heading"></a></h2>
<p>Primary Bootloader is first pice of code that executes on Power-ON. Primary Bootloader is located on Boot ROM of the processor. The functionality of the primary bootloader is to verify the authenticity of the secondary bootloader and load it. Usually if primary bootloader fails to load the Secondary Bootloader, it will load EDL or Emergency Download Mode, which is compatible with Fastboot. The EDL Mode shall prompt us in flashing the new software on to the device.</p>
</section>
<section id="secondary-bootloader">
<h2>Secondary Bootloader<a class="headerlink" href="#secondary-bootloader" title="Permalink to this heading"></a></h2>
<p>Secondary Bootloader usually resides on a NAND based eMMC. The secondary bootloader is responsible for initializing and setting Networks, RAM, Flash Memory and so on. Once the secondary bootloader is successfully loaded, its functionality is to invoke TrustZone, which verifies integrity of each images. More covered on topic Android Partitions.</p>
</section>
<section id="kernel">
<h2>Kernel<a class="headerlink" href="#kernel" title="Permalink to this heading"></a></h2>
<p>Secondary bootloader then passes the control to Kernel. Seconday Bootloader shares DTBO memory region with Kernel, where Hardware topology and hardcoded information is found. The Kernel used in Android is modified version of Linux Kernel. Kernel initializes the complete Scheduler, Process Subsystem, Memory Subsystem, Hardware Drivers and so on. Android Kernel also consist of additional modules such as Binder, Ashmem (Android Shared Memory), Drivers for ADB (Android Debug Bridge), Wakelocks, Logcat Support, OOM_handler (Low Memory Handling) and so on. Kernel then loads the initramfs.</p>
</section>
<section id="initramfs">
<h2>Initramfs<a class="headerlink" href="#initramfs" title="Permalink to this heading"></a></h2>
<p>On Android, like on many Linux-based systems, the kernel first mounts an initramfs on /init/. initramfs is a RAM based filesystem that mounts the actual root filsystem at /, thereby replacing the initramfs. Android keeps the initramfs mounted forever. Android’s initramfs contains only /init, adbd and a few configuration files.</p>
</section>
<section id="rootfs">
<h2>RootFS<a class="headerlink" href="#rootfs" title="Permalink to this heading"></a></h2>
<p>Once the Root filesystem is mounted it tries to execute the very first process init.</p>
</section>
<section id="init-process">
<h2>Init Process<a class="headerlink" href="#init-process" title="Permalink to this heading"></a></h2>
<p>Init is the first process that executes once the rootfs mounted. Init runs init.rc script. Refer init.rc topic for more details.</p>
</section>
<section id="zygote">
<h2>Zygote<a class="headerlink" href="#zygote" title="Permalink to this heading"></a></h2>
<p>Android Framework starts loading and Zygote is considered to be the first service started by Android. Zygote is spawned by the init process, which is responsible for starting Android applications and service processes. It loads and initializes classes that are supposed to be used very often into the heap. For example, dex data structures of libraries. After Zygote has started, it listens for commands on a socket. When a new applications starts, a command is sends to Zygote which executes a fork() system call.</p>
</section>
<section id="system-services">
<h2>System Services<a class="headerlink" href="#system-services" title="Permalink to this heading"></a></h2>
<p>Zygote forks and launches multiple core system services such as Power manager, Activity Manager, Telephony, Battery service, Alarm manager, Sensor service, Bluetooth service, Location Services and so on.</p>
</section>
<hr class="docutils" />
<section id="partitions-in-android">
<h2><strong>Partitions in Android</strong><a class="headerlink" href="#partitions-in-android" title="Permalink to this heading"></a></h2>
</section>
<section id="bootloaders">
<h2>Bootloaders<a class="headerlink" href="#bootloaders" title="Permalink to this heading"></a></h2>
<p>Bootloaders - in many steps - hand over charge to kernel after loading in RAM. These are mostly standalone ELF executable files becuase at this stage no filesystem is loaded and only executable code may work. These are all closed source components on Android device, provided by SoC vendors - either built-in or as binary blobs.</p>
<p>SBL - Secondary bootloader loaded by SoC, loads ABOOT in memory, also provides (Emergency) Download Mode (EDL) on many devices, a Firmware Update Protocol.</p>
<p>ABOOT (bootloader.img or aboot.mbn file in Factory Firmware) - Applications Bootloader is the main bootloader responsible for loading kernel or recovey and fastboot - a Firmware Update Protocol - as well.</p>
<p>Kernelflinger is a similar bootloader on Intel devices.</p>
</section>
<section id="tz-trustzone">
<h2>TZ (TrustZone)<a class="headerlink" href="#tz-trustzone" title="Permalink to this heading"></a></h2>
<p>Trustzone is used by ARM processors as an additional lock to security features. It combines user’s encryption key with a hardware specific key generated by encryption processor (like TPM on Windows) to make security breaching more difficult. It can also be used to implement Trusted Execution Environment (TEE).</p>
<p>During device boot, each stage verifies the integrity and authenticity of the next stage before handing over execution.</p>
<p>Secure boot requires the authenticity of all firmware code and data to be cryptographically verified before it is booted. This includes the kernel (loaded from the boot partition), the device tree (loaded from the dtbo partition), the system partition, the vendor partition, and so on.</p>
<p>Secure boot flow for a device is as follows:</p>
<ul class="simple">
<li><p>Bootloader authentication</p></li>
<li><p>Trusty initialization</p></li>
<li><p>VBMeta verification</p></li>
<li><p>Linux kernel validation</p></li>
<li><p>File system integrity check</p></li>
</ul>
</section>
<section id="vbmeta">
<h2>VBMETA<a class="headerlink" href="#vbmeta" title="Permalink to this heading"></a></h2>
<p>The Android partition table has a vbmeta partition that contains a VBMeta image. The vbmeta image is cryptographically signed and contains verification data (e.g. cryptographic digests) for verifying boot.img, system.img, vendor.img, dtbo.img and other partitions/images. VBMeta image is created by avbtool available inside AOSP Package.</p>
<p>The central data structure used in AVB is the VBMeta struct. This data structure contains a number of descriptors and other metadata. Descriptors are used for image hashes, image hash tree metadata, and so-called chained partitions. Vbmeta partition consists of The hash for the boot partition in a hash descriptor. Boot image is built as a chained partition, so it includes its VBMeta struct signed by the AVB boot key. For the system and vendor partitions, vbmeta partition holds the root hash, salt, and offset of the hash tree in hash tree descriptors, while the hash tree follows the data of each partition.</p>
</section>
<section id="boot-partition">
<h2>Boot Partition<a class="headerlink" href="#boot-partition" title="Permalink to this heading"></a></h2>
<p>This is the partition that enables the phone to boot, as the name suggests. It includes the kernel and the ramdisk. Without this partition, the device will simply not be able to boot. Wiping this partition from recovery should only be done if absolutely required and once done, the device must NOT be rebooted before installing a new one, which can be done by installing a ROM that includes a /boot partition.</p>
<p>DTB is loaded by bootloader at boot time and passed to kernel. On a Linux system init along with scripts, binaries kernel drivers and modules (in initrd.img), kernel (vmlinuz executable) and bootloader configuration along with modules, they all reside on root or a separate partition (mounted) at /boot. While on Android, init along with a few binaries and configuration files and kernel reside in a separate partition named “boot” with a special filesystem. Boot.img is created using tools like mkbootimg after building kernel.</p>
</section>
<section id="dtbo">
<h2>DTBO<a class="headerlink" href="#dtbo" title="Permalink to this heading"></a></h2>
<p>A DTS file is the source file used to create a computer’s device tree. It contains a list of nodes, properties, and child nodes that describes what hardware a device contains. For example, a DTS file describes the Device’s CPU, memory, buses, and peripherals. An operating system used the Device Tree to discover the topology of the hardware at runtime, and thereby support a majority of available hardware without hard coded information (assuming drivers were available for all devices). A tool, the Device Tree Compiler compiles the source into a binary form called dtb or Device Tree Blob. The bootloader loads the kernel and passes the DTB address to the Kernel, so that Kernel can discover hardware and create node points accordingly.</p>
</section>
<section id="recovery">
<h2>Recovery<a class="headerlink" href="#recovery" title="Permalink to this heading"></a></h2>
<p>Holds alternate boot partition and the recovery program that lets the device boot into a recovery console for performing advanced recovery and maintenance operations. It contains a second complete Linux system i.e. independent OS, including a user-interface application, kernel and the special recovery binary that reads a package and uses its contents to update i.e. flash or wipe itself or any other partition particularly during OTA updates.</p>
<p>Recovery is also the most commonly used method to flash custom ROM’s. ADB sideload mode through PC is a replacement of flashing files (usually .zip) through Recovery. ADB works when phone is switched on in Recovery (or ROM). ADB/fastboot setup is to be made on PC to use this mode.</p>
</section>
<section id="vendor">
<h2>Vendor<a class="headerlink" href="#vendor" title="Permalink to this heading"></a></h2>
<p>This partition is replaced with a shortcut (symbolic link in fact) to /system/vendor directory. It contains system applications and libraries that do not have source code available on AOSP but added by vendors (OEM’s). During normal operation, this partition is mounted read-only; its contents change only during an OTA update. It also contains SoC firmware images i.e. hardware specific libraries and binaries (OpenGL, ISP…).
Proprietary blobs (HALs) usually live in (/system)/vendor as shared libraries (.so files) which are loaded by Android binders when processes call a hardware component. HAL (hardware abstraction layer) is userspace alternative to traditional Linux’s system calls for drivers and is a kind of Google’s standardization for OEMs/hardware vendors, though being abandoned by mainstream Linux.</p>
</section>
<section id="system">
<h2>System<a class="headerlink" href="#system" title="Permalink to this heading"></a></h2>
<p>Contains system applications and libraries that have AOSP source code. During normal operation, this partition is mounted read-only; its contents change only during an OTA update or when flashing a new OS. Most ROM’s don’t allow root level (Admin rights in Windows) access by default. So, “rooting” is required to modify the contents of this partition. This is the actual User Interface we use on our phone i.e. system apps are installed on this partition on /system/app directory. Another important directory is /system/bin which contains executable binaries to perform each and every action by OS in background (as daemons) or by user in shell (bash) scripts or CLI (command line interface). These are native binaries (developed in C / C++ mostly) as opposed to Android apps which are developed in Java. A minimal form of Linux commands is also included in AOSP as toolbox or toybox (or user can add busybox or individual static binaries). /system/lib directory contains native libraries (shared by applications commonly) with .so extensions, which are dynamic libraries or shared objects.</p>
</section>
<section id="userdata">
<h2>Userdata<a class="headerlink" href="#userdata" title="Permalink to this heading"></a></h2>
<p>User applications are installed in different folders under /data. Apps data (user and system) is stored in /data/data. User personal data and some apps data is stored in /data/media. /data/media is also emulated as internal SDCard at /storage/emulated and symlinked at /sdcard. Personalized and apps settings are also stored in this partition. A folder /data/dalvik contains, in simple words, extracted apps to boost loading process. Java bytecode of Android apps is converted to executable code (.odex) by Dalvik Virtual Machine, separate instance of which is launched by zygote (an Android init daemon) for every app.</p>
<p>This partition is not normally touched by the OTA update process. A Factory Reset wipes this partition, normally excluding /data/media i.e. personal data. When you do a factory reset (AKA: wipe, hard reset, factory wipe, etc.), you are erasing the /data and /cache partitions. Note that a factory reset does NOT put your phone back to its factory state from an OS standpoint. OS upgrades will stay because the OS lives in /system, and that is not touched during a factory reset. So it’s not a factory reset. It’s a factory DATA reset actually.</p>
</section>
<section id="cache">
<h2>Cache<a class="headerlink" href="#cache" title="Permalink to this heading"></a></h2>
<p>cached (frequently accessed) data from OS usage and contains the firmware update package downloaded from server during OTA updates. Temporary holding area used by a few applications with the expectation that files can disappear at any time. Major use is by recovery and OTA updates. Recovery last_log is also written to this partition.</p>
</section>
<section id="odm">
<h2>ODM<a class="headerlink" href="#odm" title="Permalink to this heading"></a></h2>
<p>This partition contains original design manufacturer (ODM) customizations to system-on-chip (SoC) vendor board-support packages (BSPs). Such customizations enable ODMs to replace or customize SoC components, and implement kernel modules for board-specific components, daemons, and ODM-specific features on hardware abstraction layers (HALs). This partition is optional; typically, it’s used to contain customizations so that devices can use a single vendor image for multiple hardware SKUs.</p>
</section>
<section id="vndk">
<h2>VNDK<a class="headerlink" href="#vndk" title="Permalink to this heading"></a></h2>
<p>The Vendor Native Development Kit (VNDK) is a set of libraries installed in the system partition and designed exclusively for vendors to implement their HALs.</p>
<p>In Android 10 and lower, the vendor partition can link to VNDK libraries in the system partition, but can’t link to other libraries in the system partition. Native modules in the product partition can link to any library in the system partition. In Android 11 and higher, the product and vendor partitions can link to VNDK libraries in the system partition, but can’t link to other libraries in the system partition.</p>
</section>
<section id="project-treble">
<h2>Project Treble<a class="headerlink" href="#project-treble" title="Permalink to this heading"></a></h2>
<p>In an ideal world, there should be a generic AOSP OS and a single kernel for all Android devices, not tied to hardware and vendors. But unfortunately it isn’t so because unlike PC world, there is no standardization in mobile world. AOSP is heavily modified on silicon vendor (SoC) as well as phone vendor level. One of the worst outcome of this situation is almost no Long Term Support (LTS). There are delayed or none updates once the consumers have phone, making it vulnerable to security issues and missing new features. Project Treble (starting from Android-8) addresses this issue somewhat by creating a separation between hardware specific code and generic AOSP code.</p>
<p>Previously, phone vendors used to get AOSP code from Google, mixing it with their own cutomizations (UI, apps etc.) and the hardware specific code from SoC vendor. If a minor fix needed to be applied to AOSP code, the whole process had to be repeated because code was intermingled and fixing one thing broke the other. Google resolved this issue by specifying /vendor partition for hardware specific code, /system containing only generic code. Interaction with AOSP code will be through HIDL interfaces, thus making it possible to upgrade the both codes independently. /oem and /odm partitions were added previously for the same purpose.</p>
</section>
<hr class="docutils" />
<section id="secure-boot">
<h2><strong>Secure Boot</strong><a class="headerlink" href="#secure-boot" title="Permalink to this heading"></a></h2>
<p>Android can use dm-verity to protect non-data partitions against manipulation.</p>
<p>The goal is to prevent an attacker with physical access to the device from inserting malicious code, e.g. into low-level Android services stored on the /system or /recovery partition.</p>
<p>For partitions marked with the verity flag in the fstab, at build-time the dm-verity hash tree of the partition is computed. The hash tree is signed with an RSA key and appended as meta-data to the partition. The public part of the RSA key is added to the boot partition.</p>
<p>At boot-time, the kernel verifies the integrity of the signed hash tree in the partition meta-data using the RSA public key stored in the boot partition. Then it can compute the hash tree of the partition and compare it to the hash tree from the meta-data. If there is a mismatch, the kernel refuses to boot.</p>
<p>Therefore, if an attacker manipulates the partition, the hash tree computed at boot-time will not match the hash tree from the partition meta-data. If the attacker also manipulates the hash tree from the partition meta-data, the signature validation with the RSA public key will fail.</p>
<p>There is additional mechanism to ensure the integrity of the boot partition. This can be done with Secure-Boot-like mechanisms where the boot partition is again signed with another (RSA) key and the public part of that key is embedded at a lower level (vendor-specific). Such a chaining of verification mechanisms is referred to as a chain of trust. Ideally, you would want a chain of trust to extend down to the hardware level, with some vendor key being burned into the chip.</p>
</section>
<hr class="docutils" />
<section id="id1">
<h2><strong>Project Treble</strong><a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>The problem with 7.0 Nougat and older version of Android, is that there’s no separation between the vendor’s low level hardware code and the Android Framework that Google maintains. In Android 7.x and earlier, no formal vendor interfaces existed, so the device manufacturers had to update large portions of the Android code for each updates. This includes waiting on hardware vendors, such as SoC manufacturers, to provide their BSP (Board Support Packages) to hook hardware into the new OS.</p>
<p>Android code base is not decoupled, or did not have much in the way of plug-and-play compatibility with low level hardware; code had to be heavily tailored. This takes a considerable amount of time, testing, and cost on the part of silicon vendors and OEMs. Project Treble solves this problem by separating the Android OS Framework from the vendor hardware code implementations, therefore allowing Google and OEMs to update the OS without having to reconfigure all the the lower level hardware parts.</p>
<p>To solve the hardware abstraction layer issue, Android 8.0 Oreo and later versions formalized the division between hardwares abstraction layer, and their clients on the software side. These new formal divisions specify the interface between a HAL and its users. There are now around 60 formal interfaces for various hardware components, known as HIDLs.</p>
<p>The goal of a HIDL is to allow the framework to be replaced without having to rebuild HALs. HALs will be built by vendors or SoC makers and put in a /vendor partition on the device, enabling the framework, in its own partition, to be replaced with an over-the-air update (OTA) without recompiling the HALs. To update devices running earlier versions of Android to Android O, developers can wrap both conventional and legacy HALs in a new HIDL interface too.</p>
<p>The switch to Project Treble requires a little bit of work on the hardware vendor side too, as the way the vendor implementation is programmed to expose the hardware to Android is different to previous OS versions. Once this revised vendor implementation is on the device though, manufacturers can choose to deliver a new Android release to consumers by just updating the Android OS framework, without any reworking required from the silicon manufacturers.</p>
</section>
<section id="before-treble">
<h2>Before Treble<a class="headerlink" href="#before-treble" title="Permalink to this heading"></a></h2>
<p>Below Diagram describe how tightly coupled Android Framework was with Hardware before Project Treble.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/beforetreble.png"><img alt="../../_images/beforetreble.png" src="../../_images/beforetreble.png" style="width: 524.0px; height: 368.0px;" /></a>
</figure>
</section>
<section id="after-treble">
<h2>After Treble<a class="headerlink" href="#after-treble" title="Permalink to this heading"></a></h2>
<p>Below Diagram describe how Android Framework is decoupled from Hardware Layers.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/aftertreble.png"><img alt="../../_images/aftertreble.png" src="../../_images/aftertreble.png" style="width: 538.0px; height: 427.0px;" /></a>
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../04-SoftwareUpdate/SoftwareUpdate.html" class="btn btn-neutral float-left" title="Flashing Android" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../06-NativeAppDevelopment/NativeAppDevelopment.html" class="btn btn-neutral float-right" title="NativeAppDevelopment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Easwarnet.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>