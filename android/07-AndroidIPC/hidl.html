<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>07-AndroidIPC - HIDL - HAL Interface Descriptive Language &mdash; Easwarnet  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="07-AndroidIPC - Android Interface Definition Language (AIDL)" href="aidl.html" />
    <link rel="prev" title="07-AndroidIPC - Binder" href="binder.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Easwarnet
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">C++</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cpp-smartptr.html">C++ - Smart Pointer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpp-inheritence.html">C++ - Inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpp-container.html">C++ - Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpp-stdlib.html">C++ - StdLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpp-general.html">C++ - General</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../linux-posix.html">Linux - Posix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux-commands.html">Linux - Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../os-general.html">Os - General Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AOSP</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01-Introduction/androidarchitecture.html">01-Introduction - Android Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-Introduction/features.html">01-Introduction - Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-Introduction/hardwarecompatibility.html">01-Introduction - Hardware Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-Introduction/characteristics.html">01-Introduction - Characteristics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-AndroidBuildSystem/aospoverview.html">02-AndroidBuildSystem - AOSP Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-AndroidBuildSystem/downloadaosp.html">02-AndroidBuildSystem - Download AOSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-AndroidBuildSystem/androidbuildsystem.html">02-AndroidBuildSystem - Android Build System in Detail</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-AndroidBuildSystem/buildingandroid.html">02-AndroidBuildSystem - Building Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-AndroidTools/adb.html">03-AndroidTools - ADB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-AndroidTools/fastboot.html">03-AndroidTools - Fastboot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-AndroidTools/othertools.html">03-AndroidTools - Other Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04-SoftwareUpdate/flashingandroid.html">04-SoftwareUpdate - Flashing Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04-SoftwareUpdate/ota.html">04-SoftwareUpdate - OTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-BootAndPartitions/bootsequence.html">05-BootAndPartitions - Boot Sequence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-BootAndPartitions/partitions.html">05-BootAndPartitions - Partitions in Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-BootAndPartitions/secureboot.html">05-BootAndPartitions - Secure Boot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-BootAndPartitions/treble.html">05-BootAndPartitions - Project Treble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-NativeAppDevelopment/initrc.html">06-NativeAppDevelopment - Init RC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-NativeAppDevelopment/selinux.html">06-NativeAppDevelopment - SELinux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-NativeAppDevelopment/nativeapplications.html">06-NativeAppDevelopment - Native Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-NativeAppDevelopment/ndk.html">06-NativeAppDevelopment - NDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-NativeAppDevelopment/systemservices.html">06-NativeAppDevelopment - System Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-NativeAppDevelopment/systemproperties.html">06-NativeAppDevelopment - System Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-NativeAppDevelopment/hal.html">06-NativeAppDevelopment - Hardware Abstraction Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-NativeAppDevelopment/vhal.html">06-NativeAppDevelopment - VHAL - Vehicle HAL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-NativeAppDevelopment/vndk.html">06-NativeAppDevelopment - Vendor Native Development Kit (VNDK)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-NativeAppDevelopment/loggingdebugging.html">06-NativeAppDevelopment - Logging and Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="binder.html">07-AndroidIPC - Binder</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">07-AndroidIPC - HIDL - HAL Interface Descriptive Language</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#implementation-steps">Implementation steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hal-file">1. HAL file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-hidl">2. Generate HIDL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hidl-server">3. HIDL Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hidl-client">4. HIDL Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build">5. Build</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aidl.html">07-AndroidIPC - Android Interface Definition Language (AIDL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08-AppCoreComponents/activities.html">08-AppCoreComponents - Activities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08-AppCoreComponents/services.html">08-AppCoreComponents - Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08-AppCoreComponents/broadcast.html">08-AppCoreComponents - Broadcast Receivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08-AppCoreComponents/contentproviders.html">08-AppCoreComponents - Content Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09-TestFramework/cts.html">09-TestFramework - Android CTS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09-TestFramework/vts.html">09-TestFramework - Android VTS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Embedded Beginner</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../os-rtos.html">Os - RTOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c-pointers.html">C - Pointers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c-funcpointers.html">C - Function Pointers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c-general.html">C - General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c-basicalgo.html">C - Basic Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c-tricks.html">C - Tricks and Others</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../profile.html"><strong>About</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../profile.html#coming-soon">Coming Soon</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Easwarnet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>07-AndroidIPC - HIDL - HAL Interface Descriptive Language</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="androidipc-hidl-hal-interface-descriptive-language">
<h1>07-AndroidIPC - HIDL - HAL Interface Descriptive Language<a class="headerlink" href="#androidipc-hidl-hal-interface-descriptive-language" title="Permalink to this heading"></a></h1>
<p>Native Applications in Android are the application that are coded primarily in C/C++. This is done for creating abstraction layers for few interfaces in Kernel or Hardware. One such instances is creating HAL for Sensors and other devices. HAL is usually implemented using HIDL. HAL interface definition language or HIDL is an interface description language (IDL) to specify the interface between a HAL and its users. It allows specifying types and method calls, collected into interfaces and packages.</p>
<section id="implementation-steps">
<h2>Implementation steps<a class="headerlink" href="#implementation-steps" title="Permalink to this heading"></a></h2>
<section id="hal-file">
<h3>1. HAL file<a class="headerlink" href="#hal-file" title="Permalink to this heading"></a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ mkdir -p &lt;AOSP&gt;/vendor/vendorname/hardware/interfaces/testhidl/1.0/
$ vi &lt;AOSP&gt;/vendor/vendorname/hardware/interfaces/testhidl/1.0/ITestHidl.hal
</pre></div>
</div>
<p>Sample HAL Content</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">vendor</span><span class="o">.</span><span class="n">vendorname</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">testhidl</span><span class="nd">@1</span><span class="o">.</span><span class="mi">0</span><span class="p">;</span>

<span class="n">interface</span> <span class="n">ITestHidl</span>
<span class="p">{</span>
    <span class="n">ClientRequest</span><span class="p">(</span><span class="n">uint32_t</span> <span class="n">request</span><span class="p">)</span> <span class="n">generates</span> <span class="p">(</span><span class="nb">bool</span> <span class="n">status</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="generate-hidl">
<h3>2. Generate HIDL<a class="headerlink" href="#generate-hidl" title="Permalink to this heading"></a></h3>
<p>Use the hidl-gen command to automatically generate related files:</p>
<p>Before we need to load the hidl-gen tool which is located at ./out/soong/host/linux-x86/bin/hidl-gen :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> build/envsetup
$ make hidl-gen
$ hidl-gen -Landroidbp -r android.vendor:vendor vendor.vendorname.hardware.testhidl@1.0
$ <span class="nv">PACKAGE</span><span class="o">=</span>vendor.vendorname.hardware.testhidl@1.0
$ <span class="nv">LOC</span><span class="o">=</span>android root directory vendor/vendorname/hardware/testhidl/1.0/default/
$ hidl-gen -o <span class="nv">$LOC</span> -Lc++-impl -r android.vendor:vendor -r android.hidl:system/libhidl/transport <span class="nv">$PACKAGE</span>
$ hidl-gen -o <span class="nv">$LOC</span> -Landroidbp-impl -r android.vendor:vendor -r android.hidl:system/libhidl/transport <span class="nv">$PACKAGE</span>
$ ./hardware/interfaces/update-makefiles.sh
</pre></div>
</div>
</section>
<section id="hidl-server">
<h3>3. HIDL Server<a class="headerlink" href="#hidl-server" title="Permalink to this heading"></a></h3>
<p><strong>Sample Source Code</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;hidl/HidlTransportSupport.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;log/log.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;thread&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vendor/vendorname/hardware/testhidl/1.0/ITestHidl.h&gt;</span><span class="cp"></span>

<span class="cp">#undef LOG_TAG</span>
<span class="cp">#define LOG_TAG &quot;ITestHidlServer&quot;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">vendor</span><span class="o">::</span><span class="n">vendorname</span><span class="o">::</span><span class="n">hardware</span><span class="o">::</span><span class="n">testhidl</span><span class="o">::</span><span class="n">V1_0</span><span class="o">::</span><span class="n">implementation</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TestHidl</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ITestHidl</span> <span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
    <span class="n">TestHidl</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="o">~</span><span class="n">TestHidl</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

    <span class="n">Return</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">ClientRequest</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">requestid</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">retval</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">ALOGI</span><span class="p">(</span><span class="s">&quot;Client Request&quot;</span><span class="p">);</span>

        <span class="k">switch</span> <span class="p">(</span><span class="n">requestid</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
            <span class="cm">/*Do Something*/</span><span class="p">;</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
            <span class="cm">/*Do Something*/</span><span class="p">;</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

            <span class="k">default</span><span class="o">:</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">android</span><span class="o">::</span><span class="n">hardware</span><span class="o">::</span><span class="n">configureRpcThreadpool</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">true</span> <span class="cm">/* callerWillJoin */</span><span class="p">);</span>
    <span class="n">android</span><span class="o">::</span><span class="n">sp</span><span class="o">&lt;</span><span class="n">ITestHidl</span><span class="o">&gt;</span> <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TestHidl</span><span class="p">();</span>

    <span class="n">android</span><span class="o">::</span><span class="n">status_t</span> <span class="n">status</span> <span class="o">=</span> <span class="n">service</span><span class="o">-&gt;</span><span class="n">registerAsService</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">android</span><span class="o">::</span><span class="n">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ALOGE</span><span class="p">(</span><span class="s">&quot;Failed to register service: %d&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">service</span><span class="o">-&gt;</span><span class="n">Init</span><span class="p">();</span>

    <span class="n">ALOGI</span><span class="p">(</span><span class="s">&quot;Registering as service done.&quot;</span><span class="p">);</span>

    <span class="n">android</span><span class="o">::</span><span class="n">hardware</span><span class="o">::</span><span class="n">joinRpcThreadpool</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Makefile</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cc_binary</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;testhidlserver&quot;</span><span class="p">,</span>
    <span class="n">proprietary</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="n">init_rc</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;init/testhidl.rc&quot;</span><span class="p">],</span>

    <span class="n">srcs</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;src/*.cpp&quot;</span>
    <span class="p">],</span>

    <span class="n">local_include_dirs</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;src&quot;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="n">shared_libs</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;libbase&quot;</span><span class="p">,</span>
        <span class="s2">&quot;libhidlbase&quot;</span><span class="p">,</span>
        <span class="s2">&quot;libhidltransport&quot;</span><span class="p">,</span>
        <span class="s2">&quot;liblog&quot;</span><span class="p">,</span>
        <span class="s2">&quot;libutils&quot;</span><span class="p">,</span>
        <span class="s2">&quot;libcutils&quot;</span><span class="p">,</span>
        <span class="s2">&quot;libhwbinder&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor.vendorname.hardware.testhidl@1.0&quot;</span><span class="p">,</span>
    <span class="p">],</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>Rc File</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">on</span> <span class="n">boot</span>
    <span class="n">start</span> <span class="n">testhidlserver</span>

<span class="n">service</span> <span class="n">testhidlserver</span> <span class="o">/</span><span class="n">vendor</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">testhidlserver</span>
    <span class="n">user</span> <span class="n">vendor_testhidl</span>
    <span class="n">group</span> <span class="n">vendor_testhidl</span>
    <span class="n">oneshot</span>
    <span class="n">seclabel</span> <span class="n">u</span><span class="p">:</span><span class="n">r</span><span class="p">:</span><span class="n">testhidlserver</span><span class="p">:</span><span class="n">s0</span>
</pre></div>
</div>
<p><strong>selinux</strong>
Create Selinux file which provides permissions for your HIDL Service.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">testhidlserver</span><span class="p">,</span> <span class="n">domain</span><span class="p">;</span>
<span class="nb">type</span> <span class="n">testhidlserver_exec</span><span class="p">,</span> <span class="n">exec_type</span><span class="p">,</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">vendor_file_type</span><span class="p">;</span>

<span class="n">init_daemon_domain</span><span class="p">(</span><span class="n">testhidlserver</span><span class="p">)</span>

<span class="n">hwbinder_use</span><span class="p">(</span><span class="n">testhidlserver</span><span class="p">)</span>

<span class="n">hal_server_domain</span><span class="p">(</span><span class="n">testhidlserver</span><span class="p">,</span> <span class="n">hal_testhidlclient</span><span class="p">)</span>

<span class="n">allow</span> <span class="n">testhidlserver</span> <span class="n">hwservicemanager_prop</span><span class="p">:</span><span class="n">file</span> <span class="p">{</span> <span class="nb">open</span> <span class="n">read</span> <span class="nb">getattr</span> <span class="nb">map</span> <span class="p">};</span>
</pre></div>
</div>
<p><strong>filecontext</strong>
Add your service in filecontext file “file_contexts” located under devices directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">vendor</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">testhidlserver</span> <span class="n">u</span><span class="p">:</span><span class="n">object_r</span><span class="p">:</span><span class="n">testhidlserver</span><span class="p">:</span><span class="n">s0</span>
</pre></div>
</div>
</section>
<section id="hidl-client">
<h3>4. HIDL Client<a class="headerlink" href="#hidl-client" title="Permalink to this heading"></a></h3>
<p><strong>Sample Client Listener Source Code</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;android/log.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;binder/IPCThreadState.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;binder/ProcessState.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;hidl/HidlTransportSupport.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;hidl/Status.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vendor/vendorname/hardware/testhidl/1.0/ITestHidl.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;thread&gt;</span><span class="cp"></span>

<span class="cp">#undef LOG_TAG</span>
<span class="cp">#define LOG_TAG &quot;ITestHidlClient&quot;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">vendor</span><span class="o">::</span><span class="n">vendorname</span><span class="o">::</span><span class="n">hardware</span><span class="o">::</span><span class="n">testhidl</span><span class="o">::</span><span class="n">V1_0</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ALOGI</span><span class="p">(</span><span class="s">&quot;Starting Client&quot;</span><span class="p">);</span>
    <span class="n">android</span><span class="o">::</span><span class="n">sp</span><span class="o">&lt;</span><span class="n">ITestHidl</span><span class="o">&gt;</span> <span class="n">testHidlServer</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">request_1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">auto</span> <span class="n">clientreq</span> <span class="o">=</span> <span class="n">testHidlServer</span><span class="o">-&gt;</span><span class="n">ClientRequest</span><span class="p">(</span><span class="n">request_1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">clientreq</span><span class="p">.</span><span class="n">isOk</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">clientreq</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ALOGI</span><span class="p">(</span><span class="n">LOG_TAG</span><span class="p">,</span> <span class="s">&quot;Request from Client Processed by Server&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">ALOGI</span><span class="p">(</span><span class="n">LOG_TAG</span><span class="p">,</span> <span class="s">&quot;Request from Client could not be Processed by Server&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">ALOGE</span><span class="p">(</span><span class="s">&quot;Binder call not OK&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Makefile</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cc_binary</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;testhidlclient&quot;</span><span class="p">,</span>
    <span class="n">proprietary</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>

    <span class="n">srcs</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;*.cpp&quot;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="n">local_include_dirs</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">],</span>

    <span class="n">shared_libs</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;libhidlbase&quot;</span><span class="p">,</span>
    <span class="s2">&quot;libbinder&quot;</span><span class="p">,</span>
    <span class="s2">&quot;libhidltransport&quot;</span><span class="p">,</span>
    <span class="s2">&quot;liblog&quot;</span><span class="p">,</span>
    <span class="s2">&quot;libutils&quot;</span><span class="p">,</span>
    <span class="s2">&quot;vendor.vendorname.hardware.testhidl@1.0&quot;</span><span class="p">,</span>
    <span class="p">],</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="build">
<h3>5. Build<a class="headerlink" href="#build" title="Permalink to this heading"></a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">### Below line w ill load the application to out/target/product/generic_x86_64/vendor/bin/hw/testhidl</span>
$ mmm hardware/interfaces/testhidl/1.0

<span class="c1">### Build the entire sources and run the emulator</span>
$ m
$ emulator

<span class="c1">### Test the application</span>
<span class="c1"># will list the echo service</span>
$ lshal <span class="p">|</span> grep <span class="nb">echo</span>
<span class="c1"># will show the service is up and running</span>
$ ps -A <span class="p">|</span> grep ITestHidlServer
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="binder.html" class="btn btn-neutral float-left" title="07-AndroidIPC - Binder" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="aidl.html" class="btn btn-neutral float-right" title="07-AndroidIPC - Android Interface Definition Language (AIDL)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Easwarnet.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>